# Defining my work diretory
library(tinytex)
setwd("D:/Git projects/college_works/eco_fin")
CMAX = function(w, n, s){
l = matrix(nrow=n,ncol = (w+1))
max = matrix(nrow=n, ncol = 1)
cmax = matrix(nrow=n, ncol = 1)
for (j in 1:n){
l[j, 1:(w+1)] = s[j:(w+j)]
max[j] = max(l[j, 1:(w+1)])
cmax[j] = l[j, (w+1)]/max(max[j])
}
return(cmax)
}
v= c(1, 2, 10, 5, 0)
CMAX(2,4,V )
CMAX(2,4,v )
CMAX(1, 4, v)
v= c(1, 20, 10, 5, 0)
CMAX(1, 4, v)
v= c(1, 20, 10, 3, 0)
CMAX(1, 4, v)
v= c(1, 20, 10, 3, 50)
CMAX(1, 4, v)
# Libraries
library(tseries)
library(timeSeries)
library(quantmod)
library(fGarch)
library(GetBCBData)
# Get data
ibov = getSymbols('^BVSP', src='yahoo',
from= '1999-01-01',
to = '2020-04-01',
periodicity = "monthly",    # IBOV mensal
auto.assign = F)[,4]
colnames(ibov) = 'ibov'
ibov = ibov[is.na(ibov)==F]
ind = index(ibov)
cm2 = CMAX(12,(length(ibov)-12), ibov )
var1 = quantile(cm2, 0.05)
hist(-cm2, breaks = 15, col='lightgreen',
probability = T,
main='Histograma para o CMAX diário \n com 24 janelas')
abline(v=var1)
abline(v=var1)
hist(-cm2, breaks = 15, col='lightgreen',
probability = T,
main='Histograma para o CMAX diário \n com 24 janelas')
abline(v=var1)
line(v=var1)
vline(v=var1)
abline(v=var1)
abline(v=-var1)
hist(cm2, breaks = 15, col='lightgreen',
probability = T,
main='Histograma para o CMAX diário \n com 24 janelas')
abline(v=var1)
lim = mean(cm2)-2*sd(cm2)
lim
cm2[cm2<lim]
sum((cm2<lim)*1)   # count
data = index(ibov)
data1 = data[13:length(ibov)]
# transform cmax in xts object
cmts = xts(x=cm2, order.by = data1)
library(zoo)
windows()
par(mfrow=c(1,1))
plot(as.zoo(cmts), main = 'CMAX- W24', ylim=c(0.5, 1),
type='l', ylab='CMAX', xlab='Ano')
abline(h=lim)
abline(h=0.95)
text(as.Date('2008-10-10'), y=0.55, labels = 'Crise \n de 2008', cex=0.8)
text(as.Date('2020-03-10'), y=0.52, labels = 'Crise \n do COVID-19', cex=0.8)
text(as.Date('2000-03-10'), y=0.6, labels = 'Bolha da \n internet', cex=0.8)
text(as.Date('2001-12-9'), y=0.6, labels = '11 de setembro', cex=0.8)
windows()
par(mfrow=c(1,1))
plot(as.zoo(cmts), main = 'CMAX- W24', ylim=c(0.5, 1),
type='l', ylab='CMAX', xlab='Ano')
abline(h=lim)
text(as.Date('2008-10-10'), y=0.55, labels = 'Crise \n de 2008', cex=0.8)
text(as.Date('2020-03-10'), y=0.52, labels = 'Crise \n do COVID-19', cex=0.8)
text(as.Date('2000-03-10'), y=0.6, labels = 'Bolha da \n internet', cex=0.8)
text(as.Date('2001-12-9'), y=0.6, labels = '11 de setembro', cex=0.8)
library(ggplot2)
ggplot(data=cmts, aes(x=cmts))
ggplot(data=cmts, aes(x=cmts, y=data1))
ggplot(data=cmts, aes(y=cmts, x=data1))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()
abline(h=lim)
text(as.Date('2008-10-10'), y=0.55, labels = 'Crise \n de 2008', cex=0.8)
text(as.Date('2020-03-10'), y=0.52, labels = 'Crise \n do COVID-19', cex=0.8)
text(as.Date('2000-03-10'), y=0.6, labels = 'Bolha da \n internet', cex=0.8)
text(as.Date('2001-12-9'), y=0.6, labels = '11 de setembro', cex=0.8)
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%b %y",date_breaks  ="1 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="1 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="2 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="3 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="2 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="y",date_breaks  ="2 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="2 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels=" %y",date_breaks  ="2 year")
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels=" %y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels=" %y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`as.date(data1)`))+geom_line()+
scale_x_date(date_labels=" %y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`as.Date(data1)`))+geom_line()+
scale_x_date(date_labels=" %y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels=" %y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels=data1,date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data=cmts, aes(y=`cmts`, x=`data1`))+geom_line()+
scale_x_date(date_labels="%y",date_breaks  ="2 year")+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
text(as.Date('2008-10-10'), y=0.55, labels = 'Crise \n de 2008', cex=0.8)
text(as.Date('2020-03-10'), y=0.52, labels = 'Crise \n do COVID-19', cex=0.8)
text(as.Date('2000-03-10'), y=0.6, labels = 'Bolha da \n internet', cex=0.8)
text(as.Date('2001-12-9'), y=0.6, labels = '11 de setembro', cex=0.8)
